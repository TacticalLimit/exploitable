var express = require('express');
const { exec } = require('child_process');

var router = express.Router();

/* GET Reflected XSS page. */
router.get('/', async function(req, res, next) {
  const q = req.query.q;

  if (q) {
    // Run the lookup thing
    const command = `whois ${q}`;
    console.log(`Command: ${command}`);
    exec(command, (error, stdout, stderr) => {
      res.render('command-execution', {
        title: 'Command Execution',
        q,
        error,
        stdout,
        stderr
      });
    });
  } else {
    res.render('command-execution', { 
      title: 'Command Execution',
      q,
      error: undefined,
      stderr: undefined,
      stdout: undefined
    });  
  }

});

module.exports = router;
